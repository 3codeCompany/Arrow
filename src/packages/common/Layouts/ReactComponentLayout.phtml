<html>

<head>
    <meta name="viewport" content="width=device-width">
    <meta charset="utf-8">
    <title><?= $this->data["config"]["title"] ?></title>
    <link href="<?=$this->data["config"]["favicon"]?>" rel="icon" type="image/x-icon"/>
</head>
<body>
<?
$request = \Symfony\Component\HttpFoundation\Request::createFromGlobals();
$path = $request->getPathInfo();

$baseURL = explode("/", $path);
array_pop($baseURL);
$baseURL = implode("/", $baseURL);


$class = str_replace(["\\", "/",], "_", $path);
$class = trim($class, "_");


$class = "app_" . $class;

$data = $this->getData();

$props = json_encode(
    array_merge([
        "baseURL" => $baseURL,
        "path" => $path,
        "requestURI" => $_SERVER["REQUEST_URI"],
        "component" => $class
    ], $data)
);

if (isset($_REQUEST["__PROPS_REQUEST__"])) {
    header('Content-Type: application/json');
    echo $props;
    exit();
}

?>

<script>
    window.reactBackOfficeVar =  <?=json_encode([
        "appIcon" => "Mail",
        "appTitle" => "",
        "appMenu" => \App\Models\Common\AdministrationExtensionPoint::getElements(),
        "appBaseURL" => $request->getBasePath(),
        "user" => ["login" => $data["user"]["login"]],

        "baseURL" => $baseURL,
        "path" => $path, //$this->package.$path,
        "requestURI" => $_SERVER["REQUEST_URI"],
        "component" => $class

    ]) ?>;
    window.CONTROLS_BASE_LOCATION = '<?=addslashes($path)?>';
    window.reactVariable =  <?= $props ?>
</script>

<div id="root"></div>

<div id="modal-root"></div>

<script type="text/javascript" src="<?= $data["webpackManifest"]["vendors"]["js"] ?>"></script>
<link rel="stylesheet" href="<?= $data["webpackManifest"]["vendors"]["css"] ?>"/>


<? if ($data["webpackManifest"] && !$_SESSION["inDev"]) { ?>
    <script type="text/javascript" src="<?= $data["webpackManifest"]["admin"]["js"] ?>"></script>
<link rel="stylesheet" href="<?= $data["webpackManifest"]["admin"]["css"] ?>"/>
<? } else { ?>
    <script src="//localhost:3000/bundle.js" crossorigin></script>
<? } ?>


</body>
</html>